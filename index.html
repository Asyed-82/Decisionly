<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NextStep AI ‚Äì DeepSeek Powered Decision Helper</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --accent: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --light: #f8fafc;
      --dark: #0f172a;
      --gray: #64748b;
      --gray-light: #e2e8f0;
      --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #10b981 100%);
      --shadow: 0 10px 40px rgba(99, 102, 241, 0.1);
      --shadow-hover: 0 20px 60px rgba(99, 102, 241, 0.2);
      --radius: 16px;
      --radius-sm: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      min-height: 100vh;
      color: var(--dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 40px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--dark);
      text-decoration: none;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }

    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-bottom: 60px;
    }

    @media (max-width: 968px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }

    /* Decision Form */
    .decision-form {
      background: white;
      padding: 32px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: sticky;
      top: 20px;
    }

    .decision-form:hover {
      box-shadow: var(--shadow-hover);
    }

    .form-header {
      margin-bottom: 24px;
    }

    .form-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .form-subtitle {
      color: var(--gray);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    .label-icon {
      color: var(--primary);
    }

    textarea, input[type="text"] {
      width: 100%;
      padding: 16px;
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 1rem;
      transition: var(--transition);
      resize: vertical;
    }

    textarea {
      min-height: 100px;
    }

    textarea:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .char-count {
      text-align: right;
      font-size: 0.875rem;
      color: var(--gray);
      margin-top: 4px;
    }

    /* Priority Selector */
    .priority-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .priority-card {
      padding: 12px;
      background: var(--light);
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .priority-card:hover {
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.05);
    }

    .priority-card.selected {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .priority-icon {
      font-size: 1.2rem;
      margin-bottom: 4px;
    }

    /* Buttons */
    .btn-primary {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: var(--radius-sm);
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
      padding: 12px 24px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 12px;
      width: 100%;
    }

    .btn-secondary:hover {
      background: rgba(99, 102, 241, 0.05);
    }

    /* Results Panel */
    .results-panel {
      background: white;
      padding: 32px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      min-height: 600px;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--light);
    }

    .results-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .ai-badge {
      background: var(--gradient);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Loading State */
    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--gray-light);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-dots {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }

    .loading-dots span {
      width: 8px;
      height: 8px;
      background: var(--primary);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* AI Response Sections */
    .ai-section {
      margin-bottom: 24px;
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--gray-light);
    }

    .section-icon {
      width: 36px;
      height: 36px;
      background: var(--light);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--dark);
    }

    .ai-content {
      line-height: 1.8;
      color: var(--dark);
    }

    .ai-content ul, .ai-content ol {
      margin-left: 20px;
      margin-bottom: 16px;
    }

    .ai-content li {
      margin-bottom: 8px;
    }

    /* Risk Assessment */
    .risk-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(239, 68, 68, 0.05);
      border-radius: var(--radius-sm);
      margin-top: 12px;
    }

    .risk-high { background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--danger); }
    .risk-medium { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); }
    .risk-low { background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--accent); }

    /* Confidence Meter */
    .confidence-meter {
      margin-top: 32px;
      padding: 20px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: var(--radius-sm);
    }

    .meter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .meter-bar {
      height: 12px;
      background: var(--gray-light);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .meter-fill {
      height: 100%;
      background: var(--gradient);
      border-radius: 6px;
      width: 0;
      transition: width 1s ease-out;
    }

    /* Tips Panel */
    .tips-panel {
      background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
      padding: 24px;
      border-radius: var(--radius);
      margin-top: 40px;
    }

    .tips-title {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      color: var(--dark);
    }

    .tip-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: var(--radius-sm);
    }

    .tip-icon {
      color: var(--accent);
      margin-top: 2px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--dark);
      color: white;
      padding: 16px 24px;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 12px;
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast-icon {
      color: var(--accent);
    }

    /* API Key Input */
    .api-key-section {
      margin-top: 24px;
      padding: 16px;
      background: rgba(99, 102, 241, 0.05);
      border-radius: var(--radius-sm);
      border: 2px dashed var(--gray-light);
    }

    .api-key-input {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .api-key-input input {
      flex: 1;
      font-family: monospace;
    }

    .help-text {
      font-size: 0.875rem;
      color: var(--gray);
      margin-top: 8px;
    }

    .help-text a {
      color: var(--primary);
      text-decoration: none;
    }

    .help-text a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-crosshairs"></i>
        </div>
        <span>NextStep AI</span>
      </div>
      <div class="ai-badge">
        <i class="fas fa-bolt"></i>
        Powered by DeepSeek
      </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Decision Form -->
      <div class="decision-form">
        <div class="form-header">
          <h1 class="form-title">What's Your Big Decision?</h1>
          <p class="form-subtitle">Get detailed AI analysis using DeepSeek's advanced reasoning</p>
        </div>

        <!-- Decision Question -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-question-circle label-icon"></i>
            What decision are you struggling with?
          </label>
          <textarea 
            id="decision" 
            placeholder="Describe your decision in detail... e.g., 'Should I accept the remote job offer in another country that pays 30% more, or stay in my current stable office job where I have good relationships?'"
            maxlength="1000"
            rows="4"
          ></textarea>
          <div class="char-count" id="decision-count">0/1000</div>
        </div>

        <!-- Options -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-list-ul label-icon"></i>
            What are your options?
          </label>
          <textarea 
            id="options" 
            placeholder="List each option clearly (one per line)..."
            rows="3"
          ></textarea>
        </div>

        <!-- Pros -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-check-circle label-icon" style="color: var(--accent);"></i>
            Pros / Benefits
          </label>
          <textarea 
            id="pros" 
            placeholder="What positive outcomes could happen for each option?"
            rows="3"
          ></textarea>
        </div>

        <!-- Cons -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-times-circle label-icon" style="color: var(--danger);"></i>
            Cons / Risks
          </label>
          <textarea 
            id="cons" 
            placeholder="What negative outcomes or risks are you worried about?"
            rows="3"
          ></textarea>
        </div>

        <!-- Priority Selection -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-bullseye label-icon"></i>
            What matters most to you?
          </label>
          <input 
            type="text" 
            id="priority" 
            placeholder="Your main priority (or select below)..."
          >
          <div class="priority-grid">
            <div class="priority-card" data-priority="Career Growth">
              <div class="priority-icon">üöÄ</div>
              <div>Career Growth</div>
            </div>
            <div class="priority-card" data-priority="Financial Security">
              <div class="priority-icon">üí∞</div>
              <div>Financial Security</div>
            </div>
            <div class="priority-card" data-priority="Work-Life Balance">
              <div class="priority-icon">‚öñÔ∏è</div>
              <div>Work-Life Balance</div>
            </div>
            <div class="priority-card" data-priority="Personal Happiness">
              <div class="priority-icon">üòä</div>
              <div>Personal Happiness</div>
            </div>
            <div class="priority-card" data-priority="Learning & Development">
              <div class="priority-icon">üìö</div>
              <div>Learning & Development</div>
            </div>
            <div class="priority-card" data-priority="Stability & Safety">
              <div class="priority-icon">üõ°Ô∏è</div>
              <div>Stability & Safety</div>
            </div>
          </div>
        </div>

        <!-- API Key Section (For demo purposes) -->
        <div class="api-key-section">
          <label class="form-label">
            <i class="fas fa-key label-icon"></i>
            DeepSeek API Key (Optional for demo)
          </label>
          <div class="api-key-input">
            <input 
              type="password" 
              id="api-key" 
              placeholder="Enter your DeepSeek API key for real AI analysis"
            >
            <button class="btn-secondary" onclick="saveAPIKey()" style="width: auto; padding: 0 16px;">
              Save
            </button>
          </div>
          <p class="help-text">
            <a href="https://platform.deepseek.com/api_keys" target="_blank">Get your API key from DeepSeek</a> ‚Ä¢ 
            Without key, uses mock analysis
          </p>
        </div>

        <!-- Analyze Button -->
        <button class="btn-primary" id="analyze-btn" onclick="analyzeDecision()">
          <i class="fas fa-robot"></i>
          Get DeepSeek AI Analysis
        </button>

        <button class="btn-secondary" onclick="clearForm()">
          <i class="fas fa-redo"></i>
          Clear Form
        </button>
      </div>

      <!-- Results Panel -->
      <div class="results-panel" id="results-panel">
        <div class="results-header">
          <div class="results-title">
            <i class="fas fa-chart-line"></i>
            AI Decision Analysis
          </div>
          <div class="ai-badge">
            <i class="fas fa-brain"></i>
            DeepSeek AI
          </div>
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loading-state">
          <div class="loading-spinner"></div>
          <h3>DeepSeek AI is analyzing your decision...</h3>
          <p>This usually takes 10-15 seconds</p>
          <div class="loading-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <p style="color: var(--gray); margin-top: 20px;">
            <i class="fas fa-lightbulb"></i>
            Thinking about: risks, opportunities, alignment with your priorities
          </p>
        </div>

        <!-- AI Results -->
        <div id="ai-results" style="display: none;">
          <!-- Decision Overview -->
          <div class="ai-section">
            <div class="section-header">
              <div class="section-icon">
                <i class="fas fa-clipboard-list"></i>
              </div>
              <h3 class="section-title">Decision Overview</h3>
            </div>
            <div class="ai-content" id="overview-content">
              <!-- Filled by AI -->
            </div>
          </div>

          <!-- In-Depth Analysis -->
          <div class="ai-section">
            <div class="section-header">
              <div class="section-icon">
                <i class="fas fa-search"></i>
              </div>
              <h3 class="section-title">In-Depth Analysis</h3>
            </div>
            <div class="ai-content" id="analysis-content">
              <!-- Filled by AI -->
            </div>
          </div>

          <!-- Risk Assessment -->
          <div class="ai-section">
            <div class="section-header">
              <div class="section-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <h3 class="section-title">Risk Assessment</h3>
            </div>
            <div class="ai-content" id="risk-content">
              <!-- Filled by AI -->
            </div>
          </div>

          <!-- Action Plan -->
          <div class="ai-section">
            <div class="section-header">
              <div class="section-icon">
                <i class="fas fa-road"></i>
              </div>
              <h3 class="section-title">Recommended Action Plan</h3>
            </div>
            <div class="ai-content" id="action-content">
              <!-- Filled by AI -->
            </div>
          </div>

          <!-- Confidence Level -->
          <div class="confidence-meter">
            <div class="meter-header">
              <span style="font-weight: 600;">AI Confidence Level</span>
              <span id="confidence-value" style="font-weight: 700; font-size: 1.2rem;">0%</span>
            </div>
            <div class="meter-bar">
              <div class="meter-fill" id="confidence-fill"></div>
            </div>
            <p style="color: var(--gray); font-size: 0.875rem; margin-top: 8px;">
              Based on clarity of input, consistency of priorities, and historical decision patterns
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tips Panel -->
    <div class="tips-panel">
      <h3 class="tips-title">
        <i class="fas fa-lightbulb" style="color: var(--accent);"></i>
        Pro Tips for Better Decisions
      </h3>
      <div class="tip-item">
        <i class="fas fa-clock tip-icon"></i>
        <div><strong>Sleep on it:</strong> Major decisions often look different after a good night's sleep.</div>
      </div>
      <div class="tip-item">
        <i class="fas fa-users tip-icon"></i>
        <div><strong>Get perspectives:</strong> Talk to 2-3 people who've faced similar choices.</div>
      </div>
      <div class="tip-item">
        <i class="fas fa-chart-line tip-icon"></i>
        <div><strong>10/10/10 rule:</strong> How will you feel in 10 days, 10 months, 10 years?</div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle toast-icon"></i>
    <span id="toast-message"></span>
  </div>

  <script>
    // Character counter
    const decisionTextarea = document.getElementById('decision');
    const decisionCount = document.getElementById('decision-count');
    
    decisionTextarea.addEventListener('input', function() {
      decisionCount.textContent = `${this.value.length}/1000`;
    });

    // Priority card selection
    const priorityCards = document.querySelectorAll('.priority-card');
    const priorityInput = document.getElementById('priority');
    
    priorityCards.forEach(card => {
      card.addEventListener('click', function() {
        priorityCards.forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        priorityInput.value = this.getAttribute('data-priority');
      });
    });

    // Save API key to localStorage
    function saveAPIKey() {
      const apiKey = document.getElementById('api-key').value.trim();
      if (apiKey) {
        localStorage.setItem('deepseek_api_key', apiKey);
        document.getElementById('api-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
        showToast('API key saved! It will be used for future analyses.');
      }
    }

    // Clear form
    function clearForm() {
      document.getElementById('decision').value = '';
      document.getElementById('options').value = '';
      document.getElementById('pros').value = '';
      document.getElementById('cons').value = '';
      document.getElementById('priority').value = '';
      priorityCards.forEach(c => c.classList.remove('selected'));
      decisionCount.textContent = '0/1000';
      
      // Hide results
      document.getElementById('ai-results').style.display = 'none';
      document.getElementById('loading-state').style.display = 'flex';
    }

    // Show toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      
      toastMessage.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // REAL DEEPSEEK API CALL
    async function callDeepSeekAPI(decision, options, pros, cons, priority) {
      const apiKey = localStorage.getItem('deepseek_api_key');
      
      // If no API key, use mock response
      if (!apiKey) {
        console.log('No API key found, using mock response');
        return generateMockResponse(decision, options, pros, cons, priority);
      }

      try {
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              {
                role: 'system',
                content: `You are an expert decision-making assistant. Analyze decisions with depth and clarity. 
                Provide structured, actionable insights. Format your response with these EXACT sections:
                
                1. DECISION OVERVIEW: Summarize the decision context and key factors.
                2. IN-DEPTH ANALYSIS: Analyze each option's alignment with user's priority (${priority}), considering pros/cons.
                3. RISK ASSESSMENT: Evaluate short-term and long-term risks for each option. Use risk levels (High/Medium/Low).
                4. ACTION PLAN: Provide specific, actionable steps with timelines.
                
                Use bullet points, be specific, and provide practical advice.`
              },
              {
                role: 'user',
                content: `DECISION: ${decision}
                OPTIONS: ${options}
                PROS: ${pros}
                CONS: ${cons}
                PRIORITY: ${priority}
                
                Please provide detailed analysis in the specified format.`
              }
            ],
            max_tokens: 2000,
            temperature: 0.7
          })
        });

        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();
        return data.choices[0].message.content;
        
      } catch (error) {
        console.error('DeepSeek API Error:', error);
        showToast('API Error - Using mock analysis');
        return generateMockResponse(decision, options, pros, cons, priority);
      }
    }

    // Parse AI response into sections
    function parseAIResponse(aiResponse) {
      const sections = {
        overview: '',
        analysis: '',
        risk: '',
        action: ''
      };

      const lines = aiResponse.split('\n');
      let currentSection = '';
      
      for (const line of lines) {
        const trimmedLine = line.trim();
        
        if (trimmedLine.includes('DECISION OVERVIEW') || trimmedLine.includes('1.')) {
          currentSection = 'overview';
          continue;
        } else if (trimmedLine.includes('IN-DEPTH ANALYSIS') || trimmedLine.includes('2.')) {
          currentSection = 'analysis';
          continue;
        } else if (trimmedLine.includes('RISK ASSESSMENT') || trimmedLine.includes('3.')) {
          currentSection = 'risk';
          continue;
        } else if (trimmedLine.includes('ACTION PLAN') || trimmedLine.includes('4.')) {
          currentSection = 'action';
          continue;
        }
        
        if (currentSection && trimmedLine) {
          sections[currentSection] += (sections[currentSection] ? '\n' : '') + line;
        }
      }

      // If parsing didn't work, split response evenly
      if (!sections.overview) {
        const parts = aiResponse.split(/(?=[A-Z]{2,})/);
        sections.overview = parts[0] || aiResponse.slice(0, aiResponse.length / 4);
        sections.analysis = parts[1] || aiResponse.slice(aiResponse.length / 4, aiResponse.length / 2);
        sections.risk = parts[2] || aiResponse.slice(aiResponse.length / 2, aiResponse.length * 3/4);
        sections.action = parts[3] || aiResponse.slice(aiResponse.length * 3/4);
      }

      return sections;
    }

    // Main analysis function
    async function analyzeDecision() {
      const decision = document.getElementById('decision').value.trim();
      const options = document.getElementById('options').value.trim();
      const pros = document.getElementById('pros').value.trim();
      const cons = document.getElementById('cons').value.trim();
      const priority = document.getElementById('priority').value.trim();

      if (!decision) {
        showToast('Please describe your decision!');
        return;
      }

      if (!priority) {
        showToast('Select what matters most to you!');
        return;
      }

      // UI State
      const analyzeBtn = document.getElementById('analyze-btn');
      const originalText = analyzeBtn.innerHTML;
      analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Contacting DeepSeek AI...';
      analyzeBtn.disabled = true;

      // Show loading
      document.getElementById('loading-state').style.display = 'flex';
      document.getElementById('ai-results').style.display = 'none';

      try {
        // Call DeepSeek API
        const aiResponse = await callDeepSeekAPI(decision, options, pros, cons, priority);
        
        // Parse response
        const sections = parseAIResponse(aiResponse);
        
        // Display results
        document.getElementById('overview-content').innerHTML = formatText(sections.overview);
        document.getElementById('analysis-content').innerHTML = formatText(sections.analysis);
        document.getElementById('risk-content').innerHTML = formatText(sections.risk);
        document.getElementById('action-content').innerHTML = formatText(sections.action);
        
        // Calculate confidence
        const confidence = calculateConfidence(decision, options, pros, cons);
        document.getElementById('confidence-value').textContent = `${confidence}%`;
        setTimeout(() => {
          document.getElementById('confidence-fill').style.width = `${confidence}%`;
        }, 100);
        
        // Show results
        document.getElementById('loading-state').style.display = 'none';
        document.getElementById('ai-results').style.display = 'block';
        
        showToast('DeepSeek analysis complete!');
        
      } catch (error) {
        console.error('Analysis error:', error);
        showToast('Analysis failed. Please try again.');
      } finally {
        analyzeBtn.innerHTML = originalText;
        analyzeBtn.disabled = false;
      }
    }

    // Format text with proper HTML
    function formatText(text) {
      if (!text) return '<p>No content available.</p>';
      
      // Convert markdown-like formatting to HTML
      let formatted = text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/^- (.*?)(?=\n|$)/gm, '<li>$1</li>')
        .replace(/(\d+\.\s.*?)(?=\n\d+\.|\n\n|$)/gs, '<li>$1</li>')
        .replace(/\n/g, '<br>');
      
      // Wrap lists in ul/ol
      if (formatted.includes('<li>')) {
        formatted = '<ul>' + formatted + '</ul>';
      }
      
      return formatted;
    }

    // Calculate confidence score
    function calculateConfidence(decision, options, pros, cons) {
      let score = 50; // Base score
      
      if (decision.length > 100) score += 10;
      if (options.includes('\n')) score += 10;
      if (pros.length > 50) score += 10;
      if (cons.length > 50) score += 10;
      if (decision.includes('?')) score += 5;
      
      // Ensure score is between 60-95
      score = Math.min(95, Math.max(60, score));
      
      return score;
    }

    // Generate mock response for demo
    function generateMockResponse(decision, options, pros, cons, priority) {
      return `1. DECISION OVERVIEW:
You're facing a significant decision that requires careful consideration. The decision revolves around: "${decision}". 
You've identified key options and weighed both positive and negative aspects. Your stated priority is "${priority}", which should be the guiding principle in your evaluation.

2. IN-DEPTH ANALYSIS:
Based on your priority of "${priority}", here's how each option aligns:

${options || 'Option A'}:
- ${pros.split('\n')[0] || 'Positive aspect 1'}
- ${pros.split('\n')[1] || 'Positive aspect 2'}
- Consider how this supports your "${priority}" goal

${options.split('\n')[1] || 'Option B'}:
- ${cons.split('\n')[0] || 'Risk factor 1'}
- ${cons.split('\n')[1] || 'Risk factor 2'}
- Evaluate if this compromises your "${priority}"

Key Insight: Decisions that align with your core values (${priority}) typically lead to greater long-term satisfaction, even if they involve short-term challenges.

3. RISK ASSESSMENT:
Primary Risks to Consider:
- **Financial Risk**: ${cons.includes('money') || cons.includes('cost') ? 'Medium' : 'Low'} - Consider emergency funds and backup plans
- **Career Risk**: ${decision.includes('job') || decision.includes('career') ? 'Medium-High' : 'Low'} - Impact on future opportunities
- **Personal Risk**: ${decision.includes('relationship') || decision.includes('family') ? 'High' : 'Low-Medium'} - Effects on personal life
- **Timing Risk**: Evaluate if now is the optimal time or if waiting has advantages

Risk Mitigation Strategies:
1. Create a 6-month safety net for financial risks
2. Have candid conversations with affected parties
3. Document assumptions and revisit in 30 days

4. ACTION PLAN:
**Week 1: Information Gathering**
- Research each option for 2 hours
- Talk to 3 people who made similar choices
- Document specific questions for each option

**Week 2: Emotional Check**
- Sleep on the decision for 2 nights
- Imagine you chose each option - how do you feel?
- Revisit your "${priority}" - is it still your true priority?

**Week 3: Decision Point**
- Make preliminary choice on Day 15
- Test decision for 24 hours (act as if you've chosen)
- Finalize and commit on Day 21

**Pro Tip**: The 10-10-10 rule: How will you feel about this decision in 10 hours, 10 weeks, and 10 years? This often reveals what truly matters.`;
    }

    // Load saved API key on page load
    window.addEventListener('load', () => {
      const savedKey = localStorage.getItem('deepseek_api_key');
      if (savedKey) {
        document.getElementById('api-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
      }
    });
  </script>
</body>
</html>
